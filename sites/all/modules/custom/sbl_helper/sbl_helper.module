<?php

function set_current_season() {
  return 144;
}

function filter_single_games_player($row) {
  $player = arg(1);
  $season = arg(2);

  // Check if the field collection has the player as player 1, whose
  // player's page is displayed
  $single_game_query_player_1 = new EntityFieldQuery();

  $single_game_query_player_1->entityCondition('entity_type', 'field_collection_item')
    ->entityCondition('bundle', 'field_tm_game')
    ->propertyCondition('item_id', $row->field_mt_player_2)
    ->fieldCondition('field_mt_player_1', 'target_id', $player)
    // Bypass node access
    ->addTag('DANGEROUS_ACCESS_CHECK_OPT_OUT');

  $single_game_player_1 = $single_game_query_player_1->execute();

  $single_game_query_player_2 = new EntityFieldQuery();

  $single_game_query_player_2->entityCondition('entity_type', 'field_collection_item')
    ->entityCondition('bundle', 'field_tm_game')
    ->propertyCondition('item_id', $row->field_mt_player_2)
    ->fieldCondition('field_mt_player_2', 'target_id', $player)
    // Bypass node access
    ->addTag('DANGEROUS_ACCESS_CHECK_OPT_OUT');

  $single_game_player_2 = $single_game_query_player_2->execute();

  // Check also for the season
  $season_query = new EntityFieldQuery();

  $season_query->entityCondition('entity_type', 'node')
    ->entityCondition('bundle', 'team_match')
    ->propertyCondition('nid', $row->field_tm_spieltag_1)
    ->fieldCondition('field_tm_saison', 'tid', $season)
    // Bypass node access
    ->addTag('DANGEROUS_ACCESS_CHECK_OPT_OUT');

  $season_result = $season_query->execute();


  if(!isset($single_game_player_1['field_collection_item']) && !isset($single_game_player_2['field_collection_item'])) {
    return TRUE;
  } elseif (!isset($season_result['node'])) {
      return TRUE;
  }
}

/*
 * Load scripts and the matching jquery versions on certain pages
 */

function sbl_helper_init() {


  $module_path = drupal_get_path('module', 'sbl_helper');

// load the slick script and jquery 1.11 on the front page

// load the diplayed path. This is necessary for paths that are just aliases
// It also works for system paths and thus is more reliable than arg(x)
  $path = drupal_get_path_alias($_GET['q']);
  $path_array = explode('/', $path);

  if (drupal_is_front_page()) {
    drupal_add_js(libraries_get_path('jquery-1.11') . '/jquery-1.11.1.min.js');
    drupal_add_css(libraries_get_path('slick') . '/slick/slick.css');
    drupal_add_js(libraries_get_path('slick') . '/slick/slick.min.js');
    drupal_add_js('var jq111 = jQuery; jQuery.noConflict(true);',
      array('type' => 'inline', 'scope' => 'header'));
    drupal_add_js($module_path . '/js/sbl_slick_slider.js');
  }
}